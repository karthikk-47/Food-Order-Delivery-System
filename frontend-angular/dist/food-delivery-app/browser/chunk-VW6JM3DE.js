import{a as h}from"./chunk-CFT3KPZ3.js";import{Ga as u,Ia as l,Qa as c,d as i,m as o,p as n,s}from"./chunk-DQHUU6N5.js";var U=(()=>{class a{constructor(t,e){this.http=t,this.router=e,this.apiUrl=h.apiUrl;let r=localStorage.getItem("currentUser");this.currentUserSubject=new i(r?JSON.parse(r):null),this.currentUser=this.currentUserSubject.asObservable()}get currentUserValue(){return this.currentUserSubject.value}get token(){return localStorage.getItem("token")}login(t,e){return this.http.post(`${this.apiUrl}/auth/login`,{mobile:t,password:e}).pipe(o(r=>{r&&r.accessToken&&this.setAuthData(r)}))}register(t){return this.http.post(`${this.apiUrl}/auth/register`,t).pipe(o(e=>{e&&e.accessToken&&this.setAuthData(e)}))}devLogin(t){let e={accessToken:"dev-token-"+Date.now(),tokenType:"Bearer",userId:Math.floor(Math.random()*1e3),mobile:"9999999999",role:t};this.setAuthData(e),this.navigateByRole(t)}setAuthData(t){localStorage.setItem("token",t.accessToken);let e={id:t.userId,mobile:t.mobile,role:t.role};localStorage.setItem("currentUser",JSON.stringify(e)),localStorage.setItem("userId",t.userId.toString()),localStorage.setItem("userRole",t.role),this.currentUserSubject.next(e)}navigateByRole(t){switch(t){case"USER":this.router.navigate(["/user/dashboard"]);break;case"HOMEMAKER":this.router.navigate(["/homemaker/dashboard"]);break;case"DELIVERYEXECUTIVE":this.router.navigate(["/delivery-executive/dashboard"]);break;case"ADMIN":this.router.navigate(["/admin/dashboard"]);break;default:this.router.navigate(["/"])}}logout(t=!0){localStorage.removeItem("token"),localStorage.removeItem("currentUser"),localStorage.removeItem("userId"),localStorage.removeItem("userRole"),this.currentUserSubject.next(null),t&&this.router.navigate(["/login"])}isAuthenticated(){return!!this.token}hasRole(t){let e=this.currentUserValue;return e?e.role===t:!1}getUserId(){let t=localStorage.getItem("userId");return t?parseInt(t):null}getUserRole(){return localStorage.getItem("userRole")}validateToken(){return this.http.get(`${this.apiUrl}/auth/validate`)}getAuthHeaders(){let t=this.token;return new u({"Content-Type":"application/json",Authorization:t?`Bearer ${t}`:""})}forgotPassword(t){return this.http.post(`${this.apiUrl}/auth/forgot-password`,{mobile:t})}verifyOTP(t,e){return this.http.post(`${this.apiUrl}/auth/verify-otp`,{mobile:t,otp:e})}resetPassword(t,e,r){return this.http.post(`${this.apiUrl}/auth/reset-password`,{mobile:t,otp:e,newPassword:r})}static{this.\u0275fac=function(e){return new(e||a)(s(l),s(c))}}static{this.\u0275prov=n({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();export{U as a};

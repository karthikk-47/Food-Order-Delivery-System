import{a as Y}from"./chunk-XUZSQ64D.js";import{d as q,g as B,l as N,m as R,n as U,t as $}from"./chunk-2J73YKV5.js";import{a as W}from"./chunk-OU4M4I6I.js";import{a as j}from"./chunk-VW6JM3DE.js";import"./chunk-CFT3KPZ3.js";import{A as p,B as g,Ba as z,Ca as T,Fa as V,I as b,J as c,K as _,Oa as A,Qa as D,R as f,T as d,X as i,Y as r,Z as O,a as x,aa as h,b as M,ba as C,ca as m,ea as I,fa as a,ga as P,ha as u,ia as v,la as S,ma as w,na as E,pa as k,ua as F,v as y}from"./chunk-DQHUU6N5.js";function H(o,l){if(o&1){let e=h();i(0,"div",11),O(1,"img",12),i(2,"div",13)(3,"h3"),a(4),r(),i(5,"p",14),a(6),r(),i(7,"div",15)(8,"span",16),a(9),r(),i(10,"button",17),C("click",function(){let n=p(e).$implicit,s=m();return g(s.addToCart(n))}),a(11,"Add +"),r()()()()}if(o&2){let e=l.$implicit;c(),d("src",e.image||"assets/default-food.png",b)("alt",e.name),c(3),P(e.name),c(2),P(e.description),c(3),u("\u20B9",e.price,"")}}function K(o,l){if(o&1){let e=h();i(0,"div",20)(1,"div",21)(2,"h4"),a(3),r(),i(4,"p",16),a(5),r()(),i(6,"div",22)(7,"button",23),C("click",function(){let n=p(e).$implicit,s=m(2);return g(s.removeFromCart(n))}),a(8,"-"),r(),i(9,"span"),a(10),r(),i(11,"button",23),C("click",function(){let n=p(e).$implicit,s=m(2);return g(s.addToCart(n))}),a(12,"+"),r()()()}if(o&2){let e=l.$implicit;c(3),P(e.name),c(2),v("\u20B9",e.price," \xD7 ",e.quantity,""),c(5),P(e.quantity)}}function L(o,l){if(o&1&&(i(0,"div",18),f(1,K,13,4,"div",19),r()),o&2){let e=m();c(),d("ngForOf",e.cart)}}function G(o,l){o&1&&(i(0,"p",24),a(1,"Your cart is empty"),r())}function J(o,l){if(o&1&&(i(0,"option",28),a(1),r()),o&2){let e=l.$implicit;d("ngValue",e),c(),v(" ",e.street,", ",e.city," ")}}function Q(o,l){if(o&1){let e=h();i(0,"div",25)(1,"h3"),a(2,"Delivery Address"),r(),i(3,"select",26),E("ngModelChange",function(n){p(e);let s=m();return w(s.selectedAddress,n)||(s.selectedAddress=n),g(n)}),f(4,J,2,3,"option",27),r()()}if(o&2){let e=m();c(3),S("ngModel",e.selectedAddress),c(),d("ngForOf",e.addresses)}}function X(o,l){if(o&1&&(i(0,"div",29)(1,"h3"),a(2,"Bill Details"),r(),i(3,"div",30)(4,"span"),a(5,"Item Total"),r(),i(6,"span"),a(7),r()(),i(8,"div",30)(9,"span"),a(10,"Delivery Fee"),r(),i(11,"span"),a(12),r()(),i(13,"div",31)(14,"span"),a(15,"Total"),r(),i(16,"span"),a(17),r()()()),o&2){let e=m();c(7),u("\u20B9",e.total,""),c(5),u("\u20B9",e.deliveryFee,""),c(5),u("\u20B9",e.total+e.deliveryFee,"")}}var de=(()=>{class o{constructor(e,t,n,s){this.route=e,this.router=t,this.userService=n,this.authService=s,this.menuItems=[],this.cart=[],this.selectedAddress=null,this.addresses=[],this.total=0,this.deliveryFee=40,this.loading=!1,this.userId=null}ngOnInit(){if(this.userId=this.authService.getUserId(),!this.userId){alert("Please login to place an order"),this.router.navigate(["/login"]);return}this.homemakerId=+this.route.snapshot.params.id,this.loadMenuItems(),this.loadAddresses()}loadMenuItems(){this.userService.getHomemakerMenu(this.homemakerId).subscribe({next:e=>{this.menuItems=e},error:e=>console.error("Error loading menu:",e)})}loadAddresses(){this.userService.getUserAddresses().subscribe({next:e=>{this.addresses=e,e.length>0&&(this.selectedAddress=e.find(t=>t.isDefault)||e[0])},error:e=>console.error("Error loading addresses:",e)})}addToCart(e){let t=this.cart.find(n=>n.id===e.id);t?t.quantity++:this.cart.push(M(x({},e),{quantity:1})),this.calculateTotal()}removeFromCart(e){let t=this.cart.findIndex(n=>n.id===e.id);t>-1&&(this.cart[t].quantity>1?this.cart[t].quantity--:this.cart.splice(t,1)),this.calculateTotal()}calculateTotal(){this.total=this.cart.reduce((e,t)=>e+t.price*t.quantity,0)}placeOrder(){if(!this.userId){alert("Please login to place an order"),this.router.navigate(["/login"]);return}if(!this.selectedAddress){alert("Please select a delivery address");return}if(this.cart.length===0){alert("Please add items to cart");return}this.loading=!0;let e={homemakerId:this.homemakerId,userId:this.userId,items:this.cart,addressId:this.selectedAddress.id,amount:this.total,deliveryFee:this.deliveryFee};this.userService.createOrder(e).subscribe({next:t=>{this.initiatePayment(t)},error:t=>{console.error("Error creating order:",t),alert("Failed to create order. Please try again."),this.loading=!1}})}initiatePayment(e){let t={orderId:e.id,userId:this.userId,amount:this.total+this.deliveryFee,customerEmail:e.customerEmail||"user@example.com",customerPhone:e.customerPhone||this.authService.currentUserValue?.mobile};this.userService.createPayment(t).subscribe({next:n=>{this.openRazorpay(n)},error:n=>{console.error("Error creating payment:",n),this.loading=!1}})}openRazorpay(e){let t={key:e.razorpayKey,amount:e.amount*100,currency:e.currency,name:"Food Delivery App",description:`Order #${e.orderId}`,order_id:e.razorpayOrderId,handler:s=>{this.verifyPayment(s)},prefill:{email:e.customerEmail,contact:e.customerPhone},theme:{color:"#667eea"}},n=new Razorpay(t);n.on("payment.failed",s=>{this.handlePaymentFailure(s)}),n.open(),this.loading=!1}verifyPayment(e){let t={razorpayOrderId:e.razorpay_order_id,razorpayPaymentId:e.razorpay_payment_id,razorpaySignature:e.razorpay_signature};this.userService.verifyPayment(t).subscribe({next:()=>{alert("Payment successful! Your order has been placed."),this.router.navigate(["/user/orders"])},error:n=>{console.error("Payment verification failed:",n),alert("Payment verification failed. Please contact support.")}})}handlePaymentFailure(e){console.error("Payment failed:",e),alert("Payment failed. Please try again.")}static{this.\u0275fac=function(t){return new(t||o)(_(A),_(D),_(Y),_(j))}}static{this.\u0275cmp=y({type:o,selectors:[["app-place-order"]],standalone:!0,features:[k],decls:18,vars:7,consts:[["emptyCart",""],[1,"order-container"],[1,"order-content"],[1,"menu-section"],[1,"menu-grid"],["class","menu-item",4,"ngFor","ngForOf"],[1,"cart-section"],["class","cart-items",4,"ngIf","ngIfElse"],["class","address-section",4,"ngIf"],["class","bill-details",4,"ngIf"],[1,"btn-place-order",3,"click","disabled"],[1,"menu-item"],[3,"src","alt"],[1,"item-info"],[1,"description"],[1,"item-footer"],[1,"price"],[1,"btn-add",3,"click"],[1,"cart-items"],["class","cart-item",4,"ngFor","ngForOf"],[1,"cart-item"],[1,"item-details"],[1,"item-controls"],[3,"click"],[1,"empty-message"],[1,"address-section"],[1,"address-select",3,"ngModelChange","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],[3,"ngValue"],[1,"bill-details"],[1,"bill-row"],[1,"bill-row","total"]],template:function(t,n){if(t&1){let s=h();O(0,"app-navbar"),i(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2"),a(5,"Menu Items"),r(),i(6,"div",4),f(7,H,12,5,"div",5),r()(),i(8,"div",6)(9,"h2"),a(10,"Your Cart"),r(),f(11,L,2,1,"div",7)(12,G,2,0,"ng-template",null,0,F)(14,Q,5,2,"div",8)(15,X,18,3,"div",9),i(16,"button",10),C("click",function(){return p(s),g(n.placeOrder())}),a(17),r()()()()}if(t&2){let s=I(13);c(7),d("ngForOf",n.menuItems),c(4),d("ngIf",n.cart.length>0)("ngIfElse",s),c(3),d("ngIf",n.cart.length>0),c(),d("ngIf",n.cart.length>0),c(),d("disabled",n.cart.length===0||n.loading),c(),u(" ",n.loading?"Processing...":"Place Order"," ")}},dependencies:[V,z,T,$,R,U,N,q,B,W],styles:[".order-container[_ngcontent-%COMP%]{padding:2rem;max-width:1400px;margin:0 auto}.order-content[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr;gap:2rem}@media (max-width: 968px){.order-content[_ngcontent-%COMP%]{grid-template-columns:1fr}}.menu-section[_ngcontent-%COMP%], .cart-section[_ngcontent-%COMP%]{background:#fff;padding:1.5rem;border-radius:12px;box-shadow:0 2px 8px #0000001a}.menu-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .cart-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 1.5rem;color:#333}.menu-grid[_ngcontent-%COMP%]{display:grid;gap:1.5rem}.menu-item[_ngcontent-%COMP%]{display:flex;gap:1rem;padding:1rem;border:1px solid #e5e7eb;border-radius:8px}.menu-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100px;height:100px;object-fit:cover;border-radius:8px}.menu-item[_ngcontent-%COMP%]   .item-info[_ngcontent-%COMP%]{flex:1}.menu-item[_ngcontent-%COMP%]   .item-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem;color:#333}.menu-item[_ngcontent-%COMP%]   .item-info[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{color:#666;font-size:.875rem;margin-bottom:.75rem}.menu-item[_ngcontent-%COMP%]   .item-info[_ngcontent-%COMP%]   .item-footer[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.menu-item[_ngcontent-%COMP%]   .item-info[_ngcontent-%COMP%]   .item-footer[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:#667eea}.menu-item[_ngcontent-%COMP%]   .item-info[_ngcontent-%COMP%]   .item-footer[_ngcontent-%COMP%]   .btn-add[_ngcontent-%COMP%]{background:#667eea;color:#fff;border:none;padding:.5rem 1rem;border-radius:6px;cursor:pointer;font-weight:500}.menu-item[_ngcontent-%COMP%]   .item-info[_ngcontent-%COMP%]   .item-footer[_ngcontent-%COMP%]   .btn-add[_ngcontent-%COMP%]:hover{background:#5568d3}.cart-section[_ngcontent-%COMP%]{position:sticky;top:2rem;height:fit-content}.cart-items[_ngcontent-%COMP%]{margin-bottom:1.5rem}.cart-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem;border-bottom:1px solid #e5e7eb}.cart-item[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .25rem;color:#333}.cart-item[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{color:#666;font-size:.875rem}.cart-item[_ngcontent-%COMP%]   .item-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.cart-item[_ngcontent-%COMP%]   .item-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:30px;height:30px;border:1px solid #667eea;background:#fff;color:#667eea;border-radius:4px;cursor:pointer;font-weight:600}.cart-item[_ngcontent-%COMP%]   .item-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#667eea;color:#fff}.cart-item[_ngcontent-%COMP%]   .item-controls[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{min-width:20px;text-align:center;font-weight:600}.empty-message[_ngcontent-%COMP%]{text-align:center;color:#666;padding:2rem}.address-section[_ngcontent-%COMP%]{margin-bottom:1.5rem}.address-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .75rem;color:#333;font-size:1rem}.address-section[_ngcontent-%COMP%]   .address-select[_ngcontent-%COMP%]{width:100%;padding:.75rem;border:1px solid #e5e7eb;border-radius:8px;font-size:.875rem}.bill-details[_ngcontent-%COMP%]{padding:1rem;background:#f9fafb;border-radius:8px;margin-bottom:1.5rem}.bill-details[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 1rem;color:#333;font-size:1rem}.bill-details[_ngcontent-%COMP%]   .bill-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:.5rem;color:#666}.bill-details[_ngcontent-%COMP%]   .bill-row.total[_ngcontent-%COMP%]{margin-top:.75rem;padding-top:.75rem;border-top:1px solid #e5e7eb;font-weight:600;font-size:1.125rem;color:#333}.btn-place-order[_ngcontent-%COMP%]{width:100%;padding:1rem;background:#667eea;color:#fff;border:none;border-radius:8px;font-size:1rem;font-weight:600;cursor:pointer}.btn-place-order[_ngcontent-%COMP%]:hover:not(:disabled){background:#5568d3}.btn-place-order[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}"]})}}return o})();export{de as PlaceOrderComponent};

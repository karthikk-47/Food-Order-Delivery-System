import{a as F}from"./chunk-CFT3KPZ3.js";import{A as _,B as f,Ba as D,Ca as R,Fa as w,I,Ia as A,J as o,K as v,Oa as N,R as g,Ra as L,T as c,U as C,Ua as z,V as T,X as n,Y as i,Z as m,aa as O,ba as x,ca as p,d as k,fa as r,ga as d,ha as u,i as P,k as b,l as h,p as M,pa as y,s as E,v as S}from"./chunk-DQHUU6N5.js";var V=(()=>{class e{constructor(t){this.http=t,this.apiUrl=`${F.apiUrl}/orders`,this.trackingSubject=new k(null),this.tracking$=this.trackingSubject.asObservable()}ngOnDestroy(){this.stopTracking()}getOrderTracking(t){return this.http.get(`${this.apiUrl}/${t}/track`)}startTracking(t){this.stopTracking(),this.getOrderTracking(t).subscribe(a=>{this.trackingSubject.next(a)}),this.pollingSubscription=P(1e4).pipe(b(()=>this.getOrderTracking(t)),h(a=>a.status!=="DELIVERED"&&a.status!=="CANCELLED",!0)).subscribe(a=>{this.trackingSubject.next(a)})}stopTracking(){this.pollingSubscription&&(this.pollingSubscription.unsubscribe(),this.pollingSubscription=void 0),this.trackingSubject.next(null)}getStatusIcon(t){return{PENDING:"\u23F3",PREPARING:"\u{1F468}\u200D\u{1F373}",PREPARED:"\u2705",ACCEPTED:"\u{1F6B4}",OUTFORDELIVERY:"\u{1F6F5}",DELIVERED:"\u{1F389}",CANCELLED:"\u274C"}[t]||"\u{1F4E6}"}getStatusColor(t){return{PENDING:"#FFA500",PREPARING:"#FF8A00",PREPARED:"#2ECC71",ACCEPTED:"#3498DB",OUTFORDELIVERY:"#9B59B6",DELIVERED:"#27AE60",CANCELLED:"#E74C3C"}[t]||"#666"}static{this.\u0275fac=function(a){return new(a||e)(E(A))}}static{this.\u0275prov=M({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function $(e,s){e&1&&(n(0,"div",7),m(1,"div",8),n(2,"p"),r(3,"Loading tracking info..."),i()())}function B(e,s){if(e&1&&(n(0,"p"),r(1),i()),e&2){let t=p(2);o(),u(" Estimated arrival in ",t.tracking.remainingMinutes," mins ")}}function G(e,s){if(e&1&&(n(0,"div",25)(1,"div",26),r(2),i(),n(3,"span",27),r(4),i()()),e&2){let t=s.$implicit,a=s.index,l=p(2);T("completed",l.isStepCompleted(a))("active",l.isStepActive(a)),o(2),d(t.icon),o(2),d(t.label)}}function Y(e,s){if(e&1){let t=O();n(0,"button",33),x("click",function(){_(t);let l=p(3);return f(l.callExecutive())}),r(1," \u{1F4DE} Call "),i()}}function W(e,s){if(e&1&&(n(0,"div",28)(1,"div",29),m(2,"img",30),i(),n(3,"div",31)(4,"h3"),r(5),i(),n(6,"p"),r(7,"Your delivery partner"),i()(),g(8,Y,2,0,"button",32),i()),e&2){let t=p(2);o(2),c("src",t.tracking.executivePhoto||"assets/avatar-placeholder.png",I),o(3),d(t.tracking.executiveName||"Delivery Partner"),o(3),c("ngIf",t.tracking.executivePhone)}}function H(e,s){if(e&1&&(n(0,"div",34)(1,"span"),r(2,"Delivery OTP"),i(),n(3,"span",35),r(4),i()()),e&2){let t=p(2);o(4),d(t.tracking.customerOtp)}}function q(e,s){if(e&1&&(n(0,"div",36),m(1,"div",37),n(2,"div",38)(3,"span",39),r(4),i(),n(5,"span",40),r(6,"Order Placed"),i()()()),e&2){let t=p(2);o(4),d(t.formatTime(t.tracking.createdAt))}}function J(e,s){if(e&1&&(n(0,"div",36),m(1,"div",37),n(2,"div",38)(3,"span",39),r(4),i(),n(5,"span",40),r(6,"Order Accepted"),i()()()),e&2){let t=p(2);o(4),d(t.formatTime(t.tracking.acceptedAt))}}function K(e,s){if(e&1&&(n(0,"div",36),m(1,"div",37),n(2,"div",38)(3,"span",39),r(4),i(),n(5,"span",40),r(6,"Picked Up"),i()()()),e&2){let t=p(2);o(4),d(t.formatTime(t.tracking.pickedUpAt))}}function Q(e,s){if(e&1&&(n(0,"div",36),m(1,"div",37),n(2,"div",38)(3,"span",39),r(4),i(),n(5,"span",40),r(6,"Delivered"),i()()()),e&2){let t=p(2);o(4),d(t.formatTime(t.tracking.deliveredAt))}}function X(e,s){if(e&1&&(n(0,"div",9)(1,"div",10)(2,"span",11),r(3),i(),n(4,"div",12)(5,"h2"),r(6),i(),g(7,B,2,1,"p",13),i()(),n(8,"div",14)(9,"div",15),m(10,"div",16),i(),n(11,"div",17),g(12,G,5,6,"div",18),i()(),g(13,W,9,3,"div",19),n(14,"div",20)(15,"h3"),r(16,"Order Details"),i(),n(17,"div",21)(18,"span"),r(19,"Restaurant"),i(),n(20,"span"),r(21),i()(),n(22,"div",21)(23,"span"),r(24,"Order Amount"),i(),n(25,"span"),r(26),i()(),n(27,"div",21)(28,"span"),r(29,"Payment"),i(),n(30,"span"),r(31),i()(),g(32,H,5,1,"div",22),i(),n(33,"div",23)(34,"h3"),r(35,"Order Timeline"),i(),g(36,q,7,1,"div",24)(37,J,7,1,"div",24)(38,K,7,1,"div",24)(39,Q,7,1,"div",24),i()()),e&2){let t=p();o(),C("background",t.trackingService.getStatusColor(t.tracking.status)),o(2),d(t.trackingService.getStatusIcon(t.tracking.status)),o(3),d(t.tracking.statusMessage),o(),c("ngIf",t.tracking.remainingMinutes&&t.tracking.status!=="DELIVERED"),o(3),C("width",t.getProgressWidth()),o(2),c("ngForOf",t.steps),o(),c("ngIf",t.tracking.executiveId),o(8),d(t.tracking.homemakerName||"Home Chef"),o(5),u("\u20B9",t.tracking.amount,""),o(5),d(t.tracking.paymentMethod||"Online"),o(),c("ngIf",t.tracking.customerOtp&&t.tracking.status==="OUTFORDELIVERY"),o(4),c("ngIf",t.tracking.createdAt),o(),c("ngIf",t.tracking.acceptedAt),o(),c("ngIf",t.tracking.pickedUpAt),o(),c("ngIf",t.tracking.deliveredAt)}}function Z(e,s){if(e&1){let t=O();n(0,"div",41)(1,"p"),r(2),i(),n(3,"button",42),x("click",function(){_(t);let l=p();return f(l.loadTracking())}),r(4,"Retry"),i()()}if(e&2){let t=p();o(2),d(t.error)}}var st=(()=>{class e{constructor(t,a){this.route=t,this.trackingService=a,this.tracking=null,this.loading=!0,this.error="",this.steps=[{status:"PENDING",label:"Order Placed",icon:"\u{1F4DD}"},{status:"PREPARING",label:"Preparing",icon:"\u{1F468}\u200D\u{1F373}"},{status:"PREPARED",label:"Ready",icon:"\u2705"},{status:"OUTFORDELIVERY",label:"On the Way",icon:"\u{1F6F5}"},{status:"DELIVERED",label:"Delivered",icon:"\u{1F389}"}]}ngOnInit(){this.route.params.subscribe(t=>{this.orderId=+t.orderId,this.loadTracking()}),this.subscription=this.trackingService.tracking$.subscribe(t=>{t&&(this.tracking=t,this.loading=!1)})}ngOnDestroy(){this.trackingService.stopTracking(),this.subscription?.unsubscribe()}loadTracking(){this.loading=!0,this.trackingService.startTracking(this.orderId)}isStepCompleted(t){return this.tracking?this.tracking.stepNumber>t+1:!1}isStepActive(t){return this.tracking?this.tracking.stepNumber===t+1:!1}getProgressWidth(){if(!this.tracking)return"0%";let t=(this.tracking.stepNumber-1)/(this.steps.length-1)*100;return`${Math.min(t,100)}%`}formatTime(t){return t?new Date(t).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"}):"--:--"}callExecutive(){this.tracking?.executivePhone&&(window.location.href=`tel:${this.tracking.executivePhone}`)}refreshTracking(){this.loadTracking()}static{this.\u0275fac=function(a){return new(a||e)(v(N),v(V))}}static{this.\u0275cmp=S({type:e,selectors:[["app-order-tracking"]],standalone:!0,features:[y],decls:11,vars:4,consts:[[1,"tracking-container"],[1,"tracking-header"],["routerLink","/user/orders",1,"back-btn"],[1,"refresh-btn",3,"click"],["class","loading",4,"ngIf"],["class","tracking-content",4,"ngIf"],["class","error",4,"ngIf"],[1,"loading"],[1,"spinner"],[1,"tracking-content"],[1,"status-banner"],[1,"status-icon"],[1,"status-info"],[4,"ngIf"],[1,"progress-section"],[1,"progress-bar"],[1,"progress-fill"],[1,"steps"],["class","step",3,"completed","active",4,"ngFor","ngForOf"],["class","executive-card",4,"ngIf"],[1,"order-details"],[1,"detail-row"],["class","detail-row otp",4,"ngIf"],[1,"timeline"],["class","timeline-item",4,"ngIf"],[1,"step"],[1,"step-icon"],[1,"step-label"],[1,"executive-card"],[1,"executive-avatar"],["alt","Delivery Partner",3,"src"],[1,"executive-info"],["class","call-btn",3,"click",4,"ngIf"],[1,"call-btn",3,"click"],[1,"detail-row","otp"],[1,"otp-value"],[1,"timeline-item"],[1,"timeline-dot","completed"],[1,"timeline-content"],[1,"time"],[1,"event"],[1,"error"],[3,"click"]],template:function(a,l){a&1&&(n(0,"div",0)(1,"div",1)(2,"a",2),r(3,"\u2190 Back"),i(),n(4,"h1"),r(5),i(),n(6,"button",3),x("click",function(){return l.refreshTracking()}),r(7,"\u{1F504}"),i()(),g(8,$,4,0,"div",4)(9,X,40,17,"div",5)(10,Z,5,1,"div",6),i()),a&2&&(o(5),u("Track Order #",l.orderId,""),o(3),c("ngIf",l.loading),o(),c("ngIf",!l.loading&&l.tracking),o(),c("ngIf",l.error))},dependencies:[w,D,R,z,L],styles:[".tracking-container[_ngcontent-%COMP%]{max-width:600px;margin:0 auto;padding:16px;min-height:100vh;background:#f5f5f5}.tracking-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;margin-bottom:20px}.tracking-header[_ngcontent-%COMP%]   .back-btn[_ngcontent-%COMP%]{color:#666;text-decoration:none;font-size:14px}.tracking-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{flex:1;margin:0;font-size:20px;color:#333}.tracking-header[_ngcontent-%COMP%]   .refresh-btn[_ngcontent-%COMP%]{background:none;border:none;font-size:20px;cursor:pointer}.loading[_ngcontent-%COMP%]{text-align:center;padding:60px 20px}.loading[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid #f3f3f3;border-top:4px solid #00c853;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin:0 auto 16px}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.status-banner[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;padding:20px;border-radius:16px;color:#fff;margin-bottom:20px}.status-banner[_ngcontent-%COMP%]   .status-icon[_ngcontent-%COMP%]{font-size:40px}.status-banner[_ngcontent-%COMP%]   .status-info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 4px;font-size:18px}.status-banner[_ngcontent-%COMP%]   .status-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;opacity:.9;font-size:14px}.progress-section[_ngcontent-%COMP%]{background:#fff;padding:24px;border-radius:16px;margin-bottom:20px}.progress-bar[_ngcontent-%COMP%]{height:4px;background:#eee;border-radius:2px;margin-bottom:16px}.progress-bar[_ngcontent-%COMP%]   .progress-fill[_ngcontent-%COMP%]{height:100%;background:#2ecc71;border-radius:2px;transition:width .5s ease}.steps[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.step[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:8px;opacity:.4}.step.completed[_ngcontent-%COMP%], .step.active[_ngcontent-%COMP%]{opacity:1}.step.active[_ngcontent-%COMP%]   .step-icon[_ngcontent-%COMP%]{transform:scale(1.2)}.step[_ngcontent-%COMP%]   .step-icon[_ngcontent-%COMP%]{font-size:24px;transition:transform .3s}.step[_ngcontent-%COMP%]   .step-label[_ngcontent-%COMP%]{font-size:11px;color:#666;text-align:center}.executive-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;background:#fff;padding:16px;border-radius:16px;margin-bottom:20px}.executive-card[_ngcontent-%COMP%]   .executive-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:50%;object-fit:cover}.executive-card[_ngcontent-%COMP%]   .executive-info[_ngcontent-%COMP%]{flex:1}.executive-card[_ngcontent-%COMP%]   .executive-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 4px;font-size:16px;color:#333}.executive-card[_ngcontent-%COMP%]   .executive-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:13px;color:#666}.executive-card[_ngcontent-%COMP%]   .call-btn[_ngcontent-%COMP%]{background:#2ecc71;color:#fff;border:none;padding:10px 16px;border-radius:8px;font-size:14px;cursor:pointer}.executive-card[_ngcontent-%COMP%]   .call-btn[_ngcontent-%COMP%]:hover{background:#27ae60}.order-details[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:16px;margin-bottom:20px}.order-details[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 16px;font-size:16px;color:#333}.order-details[_ngcontent-%COMP%]   .detail-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:12px 0;border-bottom:1px solid #eee}.order-details[_ngcontent-%COMP%]   .detail-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.order-details[_ngcontent-%COMP%]   .detail-row.otp[_ngcontent-%COMP%]{background:#fff3e0;margin:8px -20px -20px;padding:16px 20px;border-radius:0 0 16px 16px}.order-details[_ngcontent-%COMP%]   .detail-row.otp[_ngcontent-%COMP%]   .otp-value[_ngcontent-%COMP%]{font-size:20px;font-weight:700;color:#00c853;letter-spacing:4px}.timeline[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:16px}.timeline[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 16px;font-size:16px;color:#333}.timeline-item[_ngcontent-%COMP%]{display:flex;gap:16px;padding-bottom:16px}.timeline-item[_ngcontent-%COMP%]:last-child{padding-bottom:0}.timeline-item[_ngcontent-%COMP%]   .timeline-dot[_ngcontent-%COMP%]{width:12px;height:12px;border-radius:50%;background:#ddd;margin-top:4px}.timeline-item[_ngcontent-%COMP%]   .timeline-dot.completed[_ngcontent-%COMP%]{background:#2ecc71}.timeline-item[_ngcontent-%COMP%]   .timeline-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.timeline-item[_ngcontent-%COMP%]   .timeline-content[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{font-size:12px;color:#999}.timeline-item[_ngcontent-%COMP%]   .timeline-content[_ngcontent-%COMP%]   .event[_ngcontent-%COMP%]{font-size:14px;color:#333}.error[_ngcontent-%COMP%]{text-align:center;padding:40px}.error[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:16px;background:#00c853;color:#fff;border:none;padding:12px 24px;border-radius:8px;cursor:pointer}"]})}}return e})();export{st as OrderTrackingComponent};
